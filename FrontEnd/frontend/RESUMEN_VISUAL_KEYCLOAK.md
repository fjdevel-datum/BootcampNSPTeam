# ğŸ¨ Resumen Visual - IntegraciÃ³n Keycloak Frontend

## ğŸ“Š Arquitectura de Alto Nivel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       USUARIO FINAL                           â”‚
â”‚                   (Navegador Web)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ 1. Ingresa username/password
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REACT FRONTEND (Puerto 5173)                     â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  LoginPage.tsx                                       â”‚    â”‚
â”‚  â”‚  - Formulario de login                              â”‚    â”‚
â”‚  â”‚  - Llama a login({ username, password })           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  AuthContext                                         â”‚    â”‚
â”‚  â”‚  - login()                                          â”‚    â”‚
â”‚  â”‚  - logout()                                         â”‚    â”‚
â”‚  â”‚  - isAdmin()                                        â”‚    â”‚
â”‚  â”‚  - hasRole()                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  authService.ts                                      â”‚    â”‚
â”‚  â”‚  - login() â†’ POST a Keycloak                       â”‚    â”‚
â”‚  â”‚  - Guarda tokens en localStorage                   â”‚    â”‚
â”‚  â”‚  - Decodifica JWT                                  â”‚    â”‚
â”‚  â”‚  - Extrae roles                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ 2. POST /token (username, password)
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              KEYCLOAK SERVER (Puerto 8180)                    â”‚
â”‚                                                               â”‚
â”‚  Realm: datum-travels                                         â”‚
â”‚  Client: datum-travels-frontend                               â”‚
â”‚                                                               â”‚
â”‚  3. Valida credenciales                                       â”‚
â”‚  4. Genera JWT con roles                                      â”‚
â”‚  5. Retorna: { access_token, refresh_token }                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ 6. JWT Response
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REACT FRONTEND (localStorage)                    â”‚
â”‚                                                               â”‚
â”‚  access_token: "eyJhbGc..."                                  â”‚
â”‚  refresh_token: "eyJhbGc..."                                 â”‚
â”‚                                                               â”‚
â”‚  7. Decodifica JWT:                                          â”‚
â”‚     {                                                         â”‚
â”‚       "preferred_username": "admin.test",                    â”‚
â”‚       "realm_access": {                                      â”‚
â”‚         "roles": ["admin", "user"]                           â”‚
â”‚       }                                                       â”‚
â”‚     }                                                         â”‚
â”‚                                                               â”‚
â”‚  8. Actualiza AuthContext:                                   â”‚
â”‚     - user = { username, email, name, roles }               â”‚
â”‚     - isAuthenticated = true                                â”‚
â”‚                                                               â”‚
â”‚  9. Redirige segÃºn rol:                                      â”‚
â”‚     - Si admin â†’ /admin                                      â”‚
â”‚     - Si user â†’ /home                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flujo de NavegaciÃ³n con ProtecciÃ³n de Rutas

```
Usuario accede a URL
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¿EstÃ¡ autenticado? â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚
   NO            SI
    â”‚             â”‚
    â†“             â†“
Redirect     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  a "/"      â”‚ Â¿Requiere rol?    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                 â”‚
            NO                SI
             â”‚                 â”‚
             â†“                 â†“
        Mostrar         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         pÃ¡gina         â”‚ Â¿Tiene el rol?    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                 â”‚
                       SI                NO
                        â”‚                 â”‚
                        â†“                 â†“
                   Mostrar          Redirect
                    pÃ¡gina           a /home
```

## ğŸ›¡ï¸ Componentes de Seguridad

### ProtectedRoute (Cualquier usuario autenticado)

```tsx
<ProtectedRoute>
  <HomePage />
</ProtectedRoute>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ProtectedRoute                  â”‚
â”‚                                  â”‚
â”‚  if (!isAuthenticated) {         â”‚
â”‚    return <Navigate to="/" />    â”‚
â”‚  }                               â”‚
â”‚                                  â”‚
â”‚  return <HomePage />             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RoleGuard (Solo usuarios con rol especÃ­fico)

```tsx
<RoleGuard allowedRoles={['admin']}>
  <AdminDashboard />
</RoleGuard>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RoleGuard                       â”‚
â”‚                                  â”‚
â”‚  if (!isAuthenticated) {         â”‚
â”‚    return <Navigate to="/" />    â”‚
â”‚  }                               â”‚
â”‚                                  â”‚
â”‚  if (!hasRole('admin')) {        â”‚
â”‚    return <Navigate to="/home"/> â”‚
â”‚  }                               â”‚
â”‚                                  â”‚
â”‚  return <AdminDashboard />       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ Estructura de Archivos

```
src/
â”œâ”€â”€ ğŸ“ config/
â”‚   â””â”€â”€ constants.ts          # ConfiguraciÃ³n (URLs, roles)
â”‚
â”œâ”€â”€ ğŸ“ context/
â”‚   â””â”€â”€ AuthContext.tsx       # Estado global de autenticaciÃ³n
â”‚
â”œâ”€â”€ ğŸ“ hooks/
â”‚   â””â”€â”€ useAuth.ts            # Hook para consumir AuthContext
â”‚
â”œâ”€â”€ ğŸ“ components/
â”‚   â”œâ”€â”€ ProtectedRoute.tsx    # Requiere login
â”‚   â”œâ”€â”€ RoleGuard.tsx         # Requiere rol especÃ­fico
â”‚   â””â”€â”€ UserNav.tsx           # Info usuario + logout
â”‚
â”œâ”€â”€ ğŸ“ layout/
â”‚   â””â”€â”€ MainLayout.tsx        # Layout con header + nav
â”‚
â”œâ”€â”€ ğŸ“ services/
â”‚   â””â”€â”€ authService.ts        # ComunicaciÃ³n con Keycloak
â”‚
â”œâ”€â”€ ğŸ“ types/
â”‚   â””â”€â”€ auth.ts               # Tipos TypeScript
â”‚
â”œâ”€â”€ ğŸ“ utils/
â”‚   â””â”€â”€ jwtDecoder.ts         # Decodificar JWT manualmente
â”‚
â”œâ”€â”€ ğŸ“ pages/
â”‚   â”œâ”€â”€ Login.tsx             # PÃ¡gina de login
â”‚   â”œâ”€â”€ Home.tsx              # Dashboard usuario
â”‚   â”œâ”€â”€ Profile.tsx           # Perfil usuario
â”‚   â””â”€â”€ Admin/
â”‚       â”œâ”€â”€ Dashboard.tsx     # Panel admin (solo admin)
â”‚       â”œâ”€â”€ Usuarios.tsx      # GestiÃ³n usuarios (solo admin)
â”‚       â””â”€â”€ Tarjetas.tsx      # GestiÃ³n tarjetas (solo admin)
â”‚
â””â”€â”€ ğŸ“ router/
    â””â”€â”€ index.tsx             # DefiniciÃ³n de rutas
```

## ğŸ” Mapeo de Roles a Rutas

| Ruta | Usuario Normal | Administrador |
|------|---------------|---------------|
| `/` (Login) | âœ… Acceso | âœ… Acceso |
| `/home` | âœ… Acceso | âœ… Acceso |
| `/profile` | âœ… Acceso | âœ… Acceso |
| `/tarjetas` | âœ… Acceso | âœ… Acceso |
| `/event/:id` | âœ… Acceso | âœ… Acceso |
| `/admin` | âŒ **Bloqueado** | âœ… Acceso |
| `/admin/usuarios` | âŒ **Bloqueado** | âœ… Acceso |
| `/admin/tarjetas` | âŒ **Bloqueado** | âœ… Acceso |
| `/admin/perfil` | âŒ **Bloqueado** | âœ… Acceso |

## ğŸ¯ Estados de AutenticaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthState                                               â”‚
â”‚                                                          â”‚
â”‚  user: {                                                 â”‚
â”‚    username: "admin.test",                              â”‚
â”‚    email: "admin@datum.com",                            â”‚
â”‚    name: "Admin Test",                                  â”‚
â”‚    roles: ["admin", "user"]                             â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â”‚  accessToken: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..." â”‚
â”‚  refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."â”‚
â”‚  isAuthenticated: true                                   â”‚
â”‚  isLoading: false                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Refresh de Tokens AutomÃ¡tico

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Usuario hace peticiÃ³n                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. getValidAccessToken()                             â”‚
â”‚     - Lee access_token de localStorage                â”‚
â”‚     - Verifica si expirÃ³ (exp < now)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Â¿ExpirÃ³? â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚
        NO                    SI
         â”‚                     â”‚
         â†“                     â†“
    Retornar         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     token           â”‚ refreshAccessToken() â”‚
                     â”‚ - POST /token        â”‚
                     â”‚ - grant_type=refresh â”‚
                     â”‚ - Actualiza tokens   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Â¿Refresh exitoso?    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
                   SI                  NO
                    â”‚                   â”‚
                    â†“                   â†“
               Retornar            logout()
             nuevo token         Redirect "/"
```

## ğŸ§ª Testing - Casos de Uso

### âœ… Caso 1: Login Exitoso como Admin

```
Input:
  Username: admin.test
  Password: admin123

Expected:
  âœ… Token JWT recibido
  âœ… Roles: ["admin", "user"]
  âœ… Redirect a /admin
  âœ… Puede acceder a todas las rutas
```

### âœ… Caso 2: Login Exitoso como Usuario

```
Input:
  Username: usuario.test
  Password: usuario123

Expected:
  âœ… Token JWT recibido
  âœ… Roles: ["user"]
  âœ… Redirect a /home
  âŒ NO puede acceder a /admin/*
```

### âœ… Caso 3: Credenciales InvÃ¡lidas

```
Input:
  Username: invalido
  Password: wrong

Expected:
  âŒ Error 401
  âŒ Mensaje: "Credenciales invÃ¡lidas"
  âŒ No se guarda token
  âŒ Permanece en pÃ¡gina de login
```

### âœ… Caso 4: Acceso sin AutenticaciÃ³n

```
Input:
  URL: /home (sin token)

Expected:
  âŒ ProtectedRoute bloquea
  âŒ Redirect a /
```

### âœ… Caso 5: Usuario sin Permisos

```
Input:
  Usuario: usuario.test (rol: user)
  URL: /admin

Expected:
  âŒ RoleGuard bloquea
  âŒ Redirect a /home
```

### âœ… Caso 6: Logout

```
Input:
  Click en botÃ³n "Salir"

Expected:
  âœ… POST a /logout en Keycloak
  âœ… Limpia localStorage
  âœ… AuthContext â†’ isAuthenticated = false
  âœ… Redirect a /
```

## ğŸ“ˆ Diagrama de Secuencia

```
Usuario    LoginPage   AuthContext   authService   Keycloak   localStorage
  â”‚            â”‚            â”‚             â”‚            â”‚            â”‚
  â”‚  Submit    â”‚            â”‚             â”‚            â”‚            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚             â”‚            â”‚            â”‚
  â”‚            â”‚  login()   â”‚             â”‚            â”‚            â”‚
  â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚            â”‚            â”‚
  â”‚            â”‚            â”‚  login()    â”‚            â”‚            â”‚
  â”‚            â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚            â”‚
  â”‚            â”‚            â”‚             â”‚  POST      â”‚            â”‚
  â”‚            â”‚            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
  â”‚            â”‚            â”‚             â”‚            â”‚            â”‚
  â”‚            â”‚            â”‚             â”‚   JWT      â”‚            â”‚
  â”‚            â”‚            â”‚             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
  â”‚            â”‚            â”‚             â”‚            â”‚            â”‚
  â”‚            â”‚            â”‚             â”‚  setItem   â”‚            â”‚
  â”‚            â”‚            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚            â”‚            â”‚             â”‚            â”‚            â”‚
  â”‚            â”‚            â”‚  tokens     â”‚            â”‚            â”‚
  â”‚            â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚            â”‚
  â”‚            â”‚            â”‚             â”‚            â”‚            â”‚
  â”‚            â”‚  setState  â”‚             â”‚            â”‚            â”‚
  â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚            â”‚            â”‚
  â”‚            â”‚            â”‚             â”‚            â”‚            â”‚
  â”‚  Redirect  â”‚            â”‚             â”‚            â”‚            â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚             â”‚            â”‚            â”‚
  â”‚            â”‚            â”‚             â”‚            â”‚            â”‚
```

## ğŸ¨ UI/UX States

### Estado: Loading

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                â”‚
â”‚      [Loading Spinner]         â”‚
â”‚   Verificando sesiÃ³n...        â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estado: Login Form

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      [DATUM LOGO]              â”‚
â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¤ USUARIO               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”’ CONTRASEÃ‘A            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”µ Google Sign In        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     INGRESAR             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estado: Authenticated (Header)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Datum Travels  [Home][Tarjetas][Perfil][Admin]    â”‚
â”‚                                                      â”‚
â”‚                     [ğŸ‘¤ Admin Test â–¼] [ğŸšª Salir]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Checklist de ImplementaciÃ³n

- [x] Tipos TypeScript (auth.ts)
- [x] JWT Decoder manual (jwtDecoder.ts)
- [x] Servicio de autenticaciÃ³n (authService.ts)
- [x] AuthContext con estado global
- [x] Hook useAuth
- [x] ProtectedRoute component
- [x] RoleGuard component
- [x] UserNav component
- [x] MainLayout con navegaciÃ³n
- [x] ActualizaciÃ³n de router con protecciÃ³n
- [x] ActualizaciÃ³n de LoginPage
- [x] ConfiguraciÃ³n centralizada (constants.ts)
- [x] Variables de entorno (.env.example)
- [x] DocumentaciÃ³n completa
- [x] Script de setup (setup-keycloak.ps1)

---

**ğŸ‰ IntegraciÃ³n completa y lista para usar!**
