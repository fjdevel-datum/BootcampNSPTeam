<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login</title>
  <style>
    :root{--bg:#0f172a;--panel:#111827;--text:#e5e7eb;--muted:#9ca3af;--accent:#22c55e;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;background:var(--bg);color:var(--text)}
    main{max-width:520px;margin:48px auto;padding:0 16px}
    h1{margin:0 0 8px 0}
    .card{background:var(--panel);border-radius:14px;padding:16px;border:1px solid #1f2937}
    form{display:grid;gap:16px;margin:16px 0}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label.small{font-size:.9rem;color:var(--muted)}
    input[type="text"], input[type="password"]{background:#0b1220;border:1px solid #1f2937;border-radius:10px;padding:10px;color:var(--text)}
    button{background:var(--accent);border:none;color:#04240f;padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:700}
    small.muted{color:var(--muted)}
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      const form = document.getElementById('login-form');
      const user = document.getElementById('login-user');
      const pass = document.getElementById('login-pass');
      const status = document.getElementById('login-status');

      if (localStorage.getItem('loggedIn') === 'true') {
        window.location.href = '/';
        return;
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        status.textContent = '';
        const nombreUsuario = user.value.trim();
        const contrasena = pass.value;
        if(!nombreUsuario || !contrasena){
          status.textContent = 'Completa usuario y contrase침a.';
          return;
        }
        try{
          const res = await fetch('/auth/login', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ nombreUsuario, contrasena })
          });
          const txt = await res.text();
          let data; try{ data = JSON.parse(txt); } catch { data = { message: txt }; }
          if(res.ok){
            localStorage.setItem('loggedIn','true');
            status.textContent = 'Login OK. Redirigiendo...';
            window.location.href = '/';
          } else if (res.status === 401) {
            status.textContent = (data && data.message) ? data.message : 'Credenciales inv치lidas.';
          } else {
            status.textContent = 'Error de login: ' + (data && data.message ? data.message : res.status);
          }
        } catch(err){
          console.error(err);
          status.textContent = 'No se pudo conectar al backend.';
        }
      });
    });
  </script>
  </head>
  <body>
    <main>
      <h1>Iniciar sesi칩n</h1>
      <section class="card">
        <form id="login-form">
          <div class="row">
            <div>
              <label class="small">Usuario</label>
              <input type="text" id="login-user" required />
            </div>
            <div>
              <label class="small">Contrase침a</label>
              <input type="password" id="login-pass" required />
            </div>
          </div>
          <button type="submit">Entrar</button>
          <small id="login-status" class="muted"></small>
        </form>
      </section>
    </main>
  </body>
  </html>

