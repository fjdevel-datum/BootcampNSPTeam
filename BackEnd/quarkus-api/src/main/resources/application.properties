# Oracle XE Database connection - Puerto 1522 para evitar conflictos
quarkus.datasource.db-kind=oracle
quarkus.datasource.username=datum_user
quarkus.datasource.password=datum2025
quarkus.datasource.jdbc.url=jdbc:oracle:thin:@localhost:1522/XEPDB1

# ════════════════════════════════════════════════════════════════════════════
# Hibernate ORM Configuration
# ════════════════════════════════════════════════════════════════════════════
# 
# OPCIONES DE DATABASE.GENERATION:
# 
# 1. drop-and-create → Borra y recrea tablas cada vez (SOLO PARA DESARROLLO INICIAL)
#    ⚠️ PIERDE TODOS LOS DATOS al reiniciar!
# 
# 2. update → Actualiza el esquema sin borrar datos (RECOMENDADO PARA DESARROLLO)
#    ✅ MANTIENE los datos existentes
#    ✅ Agrega nuevas columnas/tablas si detecta cambios
#    ⚠️ No elimina columnas obsoletas
# 
# 3. validate → Solo valida que el esquema coincida (PRODUCCIÓN)
#    ✅ No modifica nada
#    ❌ Falla si hay diferencias
# 
# 4. none → No hace nada (PRODUCCIÓN con Flyway/Liquibase)
#    ✅ Control manual de migraciones
# 
# ════════════════════════════════════════════════════════════════════════════

# ✅ CONFIGURACIÓN ACTUAL: Persistir datos entre reinicios
quarkus.hibernate-orm.database.generation=update
quarkus.hibernate-orm.log.sql=true

# ⚠️ DESACTIVAR import.sql para evitar inserciones automáticas
# El archivo import.sql se ejecuta SOLO si existe y database.generation != none
# Para REACTIVAR datos iniciales, descomentar la siguiente línea:
# quarkus.hibernate-orm.sql-load-script=import.sql
quarkus.hibernate-orm.sql-load-script=no-file

# Puerto del servidor
quarkus.http.port=8081
quarkus.http.host=0.0.0.0

# CORS - Para que el Frontend se conecte sin problemas
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:5173,http://localhost:3000
quarkus.http.cors.methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.exposed-headers=Content-Disposition
quarkus.http.cors.access-control-max-age=24H

# ============================================================================
# MULTIPART/FORM-DATA - Para subir imágenes (OCR)
# ============================================================================
quarkus.http.body.handle-file-uploads=true
quarkus.http.limits.max-body-size=10M
quarkus.http.body.uploads-directory=/tmp/datum-uploads

# ALMACENAMIENTO DE ARCHIVOS
app.storage.path=/tmp/datum-files
app.storage.images.max-size=5242880


# LOGGING
quarkus.log.level=INFO
quarkus.log.category."datum.travels".level=DEBUG
quarkus.log.category."org.hibernate.SQL".level=DEBUG
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n

# DESARROLLO - Hot Reload
quarkus.live-reload.instrumentation=true

# SWAGGER para testing
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/swagger-ui

# EMAILS POR PAÍS
app.email.contabilidad.sv=contabilidad.sv@datum.com
app.email.contabilidad.gt=contabilidad.gt@datum.com
app.email.contabilidad.hn=contabilidad.hn@datum.com
app.email.contabilidad.pa=contabilidad.pa@datum.com

# KEYCLOAK CONFIGURATION
# ════════════════════════════════════════════════════════════
# 
# INSTRUCCIONES:
# 1. Levanta Keycloak: docker-compose -f docker-compose-dev.yml up -d datum-keycloak
# 2. Accede a http://localhost:8180 (admin/admin123)
# 3. Crea el realm "datum-travels"
# 4. Crea el client "datum-travels-backend" con Client Authentication ON
# 5. Copia el Client Secret de la pestaña Credentials
# 6. Reemplaza "your-client-secret-here" con tu secret real
# 7. Cambia quarkus.oidc.enabled=true
# 
# ════════════════════════════════════════════════════════════

# ✅ OIDC HABILITADO - Keycloak integrado
quarkus.oidc.enabled=true
quarkus.oidc.devservices.enabled=false

# Configuración del servidor Keycloak
keycloak.server-url=http://localhost:8180
keycloak.realm=datum-travels
keycloak.client-id=datum-travels-backend
keycloak.client-secret=tpQkr9c6f1nD8ksGoM51hexkfbnr9UvT

# Credenciales de administrador (para operaciones administrativas desde código)
keycloak.admin-username=admin
keycloak.admin-password=admin123

# Configuración de tokens
keycloak.token-expiration=3600
keycloak.refresh-token-expiration=86400

# ════════════════════════════════════════════════════════════
# OIDC CONFIGURATION (Quarkus ↔ Keycloak)
# ════════════════════════════════════════════════════════════

# URL del servidor de autorización (Keycloak)
quarkus.oidc.auth-server-url=http://localhost:8180/realms/datum-travels

# Client ID configurado en Keycloak
quarkus.oidc.client-id=datum-travels-backend

# Client Secret obtenido de Keycloak
quarkus.oidc.credentials.secret=tpQkr9c6f1nD8ksGoM51hexkfbnr9UvT

# Tipo de aplicación (service = backend API sin UI)
quarkus.oidc.application-type=service

# Habilitar verificación de tokens JWT de Keycloak
quarkus.oidc.token.issuer=http://localhost:8180/realms/datum-travels
quarkus.oidc.token.audience=account

# Configuración de roles (mapeo de realm_access.roles)
quarkus.oidc.roles.source=accesstoken
quarkus.oidc.roles.role-claim-path=realm_access/roles

# Timeout de conexión con Keycloak
quarkus.oidc.connection-timeout=10s

# ════════════════════════════════════════════════════════════
# JWT SIMPLE CONFIGURATION (Para MVP sin Keycloak)
# ════════════════════════════════════════════════════════════

# Clave secreta para firmar tokens JWT (mínimo 256 bits para HS512)
# IMPORTANTE: En producción, usar variable de entorno
jwt.secret=datum-travels-super-secret-key-2025-must-be-at-least-256-bits-long-for-hs512-algorithm
jwt.expiration=3600
jwt.issuer=datum-travels-api

# ════════════════════════════════════════════════════════════
# PERFILES DE ENTORNO
# ════════════════════════════════════════════════════════════

# DESARROLLO
%dev.keycloak.server-url=http://localhost:8180
%dev.keycloak.realm=datum-travels
%dev.keycloak.client-id=datum-travels-backend
%dev.keycloak.client-secret=tpQkr9c6f1nD8ksGoM51hexkfbnr9UvT

# PRODUCCIÓN
%prod.keycloak.server-url=https://keycloak.datumtravels.com
%prod.keycloak.realm=datum-travels
%prod.keycloak.client-id=datum-travels-backend
%prod.keycloak.client-secret=${KEYCLOAK_CLIENT_SECRET}

# ════════════════════════════════════════════════════════════
# LOGGING (para debugging)
quarkus.log.category."datum.travels.infrastructure.security".level=DEBUG
